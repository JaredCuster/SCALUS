<?xml version="1.0"?>
<?define ProductUpgradeCode="71bf8eb3-8498-438a-b1c4-e5165e0ed7a4"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" UpgradeCode="$(var.ProductUpgradeCode)"
		Name="scalus" Version="$(var.Version)" Manufacturer="One Identity" Language="1033">
		<Package InstallerVersion="$(var.Minimum_Version)" Compressed="yes" Comments="Windows Installer Package" InstallScope="perMachine" />
		<Media Id="1" Cabinet="product.cab" EmbedCab="yes"/>

		<Upgrade Id="$(var.ProductUpgradeCode)">
			<UpgradeVersion Minimum="$(var.Version)" OnlyDetect="yes" Property="NEWERVERSIONDETECTED"/>
			<UpgradeVersion Minimum="0.0.0" Maximum="$(var.Version)" IncludeMinimum="yes" IncludeMaximum="no" Property="OLDERVERSIONBEINGUPGRADED"/>
		</Upgrade>
		<Condition Message="A newer version of this software is already installed.">NOT NEWERVERSIONDETECTED</Condition>


		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="$(var.Program_Files)" >
				<Directory Id="INSTALLDIR" Name="scalus">
					<Component Id="ApplicationFiles" Guid="ae36b4af-d3ac-4f74-bdaf-98587e6fffe8" >
						<File Id="AppFile1" Source="$(var.sourcedir)\appsettings.json" />
						<File Id="AppFile2" Source="$(var.sourcedir)\scalus.exe" />
						<File Id="AppFile3" Source="$(var.sourcedir)\scalus.json" /> 
						<File Id="AppFile4" Source="$(var.sourcedir)\web.config" />
						<File Id="AppFile5" Source="$(var.tmpdir)\readme.txt" />
					</Component>
				</Directory>
			</Directory>
			<Directory Id="ProgramMenuFolder">
				<Directory Id="ProgramMenuSubfolder" Name="Scalus">
					<Component Id="ApplicationShortcuts" Guid="755ffdfc-4255-4374-99a5-e604984abb02">
						<Shortcut Id="ApplicationShortcut1" Name="ScalusUI" Description="Scalus UI" 
						Target="[INSTALLDIR]scalus.exe" WorkingDirectory="INSTALLDIR"/>
						<RegistryValue Root="HKCU" Key="Software\OneIdentity\scalus" 
							Name="installed" Type="integer" Value="1" KeyPath="yes"/>
						<RemoveFolder Id="ProgramMenuSubfolder" On="uninstall"/>
					</Component>
				</Directory>
			</Directory>
		</Directory>

		<InstallExecuteSequence>
			<RemoveExistingProducts After="InstallValidate"/>
		</InstallExecuteSequence>

		<Feature Id="DefaultFeature" Level="1">
			<ComponentRef Id="ApplicationFiles"/>
			<ComponentRef Id="ApplicationShortcuts"/>
		</Feature>
	</Product>
</Wix>
